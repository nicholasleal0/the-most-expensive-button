<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BotÃ£o MÃ¡gico - Ajude uma Causa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .btn-magic {
            position: relative;
            animation: pulse 2s infinite, float 3s ease-in-out infinite;
            transform-style: preserve-3d;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.7);
            transition: all 0.3s ease;
        }
        
        .btn-magic:hover {
            transform: scale(1.05) rotateY(10deg);
            box-shadow: 0 0 70px rgba(255, 215, 0, 0.9);
        }
        
        .btn-magic:active {
            transform: scale(0.95);
        }
        
        .btn-magic:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.7); }
            50% { box-shadow: 0 0 70px rgba(255, 215, 0, 0.9); }
            100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.7); }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .progress-bar {
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
            background: linear-gradient(90deg, #ff8a00, #e52e71);
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }
        
        .money-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        
        .money-bill {
            position: absolute;
            font-size: 24px;
            color: #2ecc71;
            animation: fall linear;
            user-select: none;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }
        
        .alert-mode {
            animation: flash 1s infinite;
        }
        
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 to-blue-900 min-h-screen text-white">
    
    <!-- Alert Banner (hidden by default) -->
    <div id="alertBanner" class="hidden bg-yellow-500 text-black font-bold py-3 px-4 text-center alert-mode">
        <span id="alertText">ðŸŽ‰ META QUASE ATINGIDA! ðŸŽ‰</span>
    </div>
    
    <!-- Error Box -->
    <div id="errorBox" class="hidden bg-red-600 text-white font-bold py-3 px-4 mb-6 rounded-lg mx-4"></div>
    
    <div class="container mx-auto px-4 py-12">
        <div class="max-w-3xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-200">
                BotÃ£o MÃ¡gico
            </h1>
            
            <p class="text-lg md:text-xl mb-8 text-yellow-200 italic">
                "Ele nÃ£o faz absolutamente nada. Mas vocÃª pode dizer que fez parte disso. E ainda ajuda uma causa nobre."
            </p>
            
            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8 border border-white/20">
                <h2 class="text-2xl font-semibold mb-4">Meta de DoaÃ§Ã£o</h2>
                
                <div class="mb-4">
                    <div class="flex justify-between mb-2">
                        <span>Arrecadado: $<span id="total-raised">0.00</span></span>
                        <span>Meta: $<span id="click-goal">100.00</span></span>
                    </div>
                    <div class="progress-bar bg-gray-700">
                        <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <p class="text-sm text-yellow-100">
                    Quando a meta for atingida, metade do valor arrecadado serÃ¡ doado para <span id="charity-name" class="font-bold">MÃ©dicos Sem Fronteiras</span>.
                </p>
            </div>
            
            <div class="relative">
                <button id="magic-btn" class="btn-magic bg-gradient-to-br from-yellow-400 to-yellow-600 text-black font-extrabold text-2xl md:text-3xl py-6 px-12 rounded-full mb-4">
                    <i class="fas fa-magic mr-2"></i> <span id="button-text">CLIQUE AQUI!</span>
                </button>
                
                <div class="text-5xl font-bold mb-8">
                    <span id="click-counter">0</span>
                </div>
                
                <p class="text-lg text-yellow-100 mb-8">
                    Cada clique adiciona <span id="amount-text">$1.00</span> Ã  nossa arrecadaÃ§Ã£o!
                </p>
            </div>
            
            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
                <h3 class="text-xl font-semibold mb-4">Detalhes da ArrecadaÃ§Ã£o</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                    <div>
                        <p><span class="font-bold">Total de cliques:</span> <span id="total-clicks">0</span></p>
                        <p><span class="font-bold">Valor por clique:</span> <span id="value-per-click">$1.00</span></p>
                    </div>
                    <div>
                        <p><span class="font-bold">Meta atual:</span> $<span id="current-goal">100.00</span></p>
                        <p><span class="font-bold">Valor a ser doado:</span> $<span id="to-donate">0.00</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Success Toast -->
    <div id="successToast" class="fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
        <span id="successMessage">Pagamento bem-sucedido! Seu clique foi contado.</span>
    </div>
    
    <div id="money-rain" class="money-rain"></div>
    
    <script>
        // Configuration
        const API_BASE_URL = '';
        
        // Global variables
        let currentData = {
            totalClicks: 0,
            currentGoal: 100,
            totalRaised: 0,
            charityName: "MÃ©dicos Sem Fronteiras",
            currency: "USD",
            amount: 100
        };
        
        // DOM elements
        const btn = document.getElementById('magic-btn');
        const counter = document.getElementById('click-counter');
        const totalClicks = document.getElementById('total-clicks');
        const totalRaisedElement = document.getElementById('total-raised');
        const progressFill = document.getElementById('progress-fill');
        const toDonate = document.getElementById('to-donate');
        const moneyRain = document.getElementById('money-rain');
        const alertBanner = document.getElementById('alertBanner');
        const errorBox = document.getElementById('errorBox');
        const buttonText = document.getElementById('button-text');
        
        // Translations
        const translations = {
            en: {
                buttonText: 'CLICK HERE!',
                successMessage: 'Payment successful! Your click has been counted.',
                errorNetwork: 'Network error. Please check your connection and try again.',
                errorPayment: 'Payment error. Please try again.',
                redirecting: 'Redirecting to payment...',
                alertText: 'ðŸŽ‰ GOAL ALMOST REACHED! ðŸŽ‰'
            },
            pt: {
                buttonText: 'CLIQUE AQUI!',
                successMessage: 'Pagamento bem-sucedido! Seu clique foi contado.',
                errorNetwork: 'Erro de rede. Verifique sua conexÃ£o e tente novamente.',
                errorPayment: 'Erro no pagamento. Tente novamente.',
                redirecting: 'Redirecionando para pagamento...',
                alertText: 'ðŸŽ‰ META QUASE ATINGIDA! ðŸŽ‰'
            }
        };

        // Detect language
        const lang = (navigator.language || navigator.userLanguage).startsWith('pt') ? 'pt' : 'en';
        const t = translations[lang];

        // Helper functions
        function setText(elementId, text) {
            const element = document.getElementById(elementId);
            if (element) element.textContent = text;
        }

        function showError(message) {
            setText('errorBox', message);
            errorBox.classList.remove('hidden');
            setTimeout(() => errorBox.classList.add('hidden'), 5000);
        }

        function formatCurrency(amount, currency = 'USD') {
            return new Intl.NumberFormat(lang === 'pt' ? 'pt-BR' : 'en-US', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 2
            }).format(amount / 100);
        }

        // Main functions
        async function fetchAndUpdateStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/status`);
                if (!response.ok) throw new Error('Failed to fetch status');
                
                const data = await response.json();
                currentData = data;
                
                // Update displays
                counter.textContent = data.totalClicks.toLocaleString(lang);
                totalClicks.textContent = data.totalClicks.toLocaleString(lang);
                totalRaisedElement.textContent = (data.totalRaised / 100).toFixed(2);
                setText('click-goal', (data.currentGoal / 100).toFixed(2));
                setText('current-goal', (data.currentGoal / 100).toFixed(2));
                setText('charity-name', data.charityName);
                toDonate.textContent = (data.totalRaised / 200).toFixed(2);
                
                // Update amount display
                const amountFormatted = formatCurrency(data.amount, data.currency);
                setText('amount-text', amountFormatted);
                setText('value-per-click', amountFormatted);

                // Update progress bar
                const progressPercent = Math.min((data.totalRaised / data.currentGoal) * 100, 100);
                progressFill.style.width = `${progressPercent}%`;

                // Alert mode when 95% reached
                if (progressPercent >= 95) {
                    document.body.classList.add('alert-mode');
                    alertBanner.classList.remove('hidden');
                    setText('alertText', t.alertText);
                } else {
                    document.body.classList.remove('alert-mode');
                    alertBanner.classList.add('hidden');
                }

                // Check if goal is reached
                if (data.totalRaised >= data.currentGoal) {
                    celebrateGoal();
                }

            } catch (error) {
                console.error('Failed to fetch status:', error);
                showError(t.errorNetwork);
            }
        }

        async function handleButtonClick() {
            // Disable button and show loading state
            btn.disabled = true;
            buttonText.textContent = t.redirecting;
            
            try {
                // First get the current status to determine currency
                const statusResponse = await fetch(`${API_BASE_URL}/api/status`);
                if (!statusResponse.ok) throw new Error('Failed to get status');
                const statusData = await statusResponse.json();
                
                const response = await fetch(`${API_BASE_URL}/api/create-checkout-session`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        currency: statusData.currency
                    })
                });

                if (!response.ok) throw new Error('Failed to create checkout session');
                
                const session = await response.json();
                
                // Create confetti effect before redirect
                createConfetti();
                
                // Redirect to Stripe Checkout
                window.location.href = session.url;
                
            } catch (error) {
                console.error('Payment error:', error);
                showError(t.errorPayment);
                
                // Re-enable button
                btn.disabled = false;
                buttonText.textContent = t.buttonText;
            }
        }

        function createConfetti() {
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.body.appendChild(confetti);
                
                // Animation
                setTimeout(() => {
                    confetti.style.opacity = '1';
                    confetti.style.transform = `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px) rotate(${Math.random() * 360}deg)`;
                    confetti.style.transition = 'all 1s ease-out';
                    
                    setTimeout(() => {
                        confetti.style.opacity = '0';
                        setTimeout(() => {
                            confetti.remove();
                        }, 1000);
                    }, 500);
                }, 10);
            }
        }
        
        function celebrateGoal() {
            moneyRain.style.display = 'block';
            
            // Create money rain
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const money = document.createElement('div');
                    money.className = 'money-bill';
                    money.innerHTML = 'ðŸ’µ';
                    money.style.left = Math.random() * 100 + 'vw';
                    money.style.top = '-50px';
                    money.style.fontSize = (Math.random() * 20 + 10) + 'px';
                    money.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    
                    moneyRain.appendChild(money);
                    
                    setTimeout(() => {
                        money.remove();
                    }, 5000);
                }, i * 200);
            }
            
            // Show celebration message
            setTimeout(() => {
                const donationAmount = (currentData.totalRaised / 200).toFixed(2);
                alert(`ðŸŽ‰ Meta atingida! $${donationAmount} serÃ£o doados para ${currentData.charityName}! Obrigado por ajudar!`);
                moneyRain.style.display = 'none';
            }, 3000);
        }

        function showSuccessToast() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('success') === 'true') {
                const toast = document.getElementById('successToast');
                setText('successMessage', t.successMessage);
                toast.classList.remove('translate-y-20', 'opacity-0');
                toast.classList.add('translate-y-0', 'opacity-100');
                
                // Create celebration effects
                createConfetti();
                
                // Hide toast after 5 seconds and clean URL
                setTimeout(() => {
                    toast.classList.add('translate-y-20', 'opacity-0');
                    window.history.replaceState({}, document.title, window.location.pathname);
                }, 5000);
                
                // Refresh data to show updated count
                setTimeout(fetchAndUpdateStatus, 1000);
            }
        }
        
        // Easter egg - cursor follower (simplified for mobile compatibility)
        if (!('ontouchstart' in window)) {
            document.addEventListener('mousemove', function(e) {
                const x = e.clientX;
                const y = e.clientY;
                
                const btnRect = btn.getBoundingClientRect();
                const btnCenterX = btnRect.left + btnRect.width / 2;
                const btnCenterY = btnRect.top + btnRect.height / 2;
                
                const distance = Math.sqrt(Math.pow(x - btnCenterX, 2) + Math.pow(y - btnCenterY, 2));
                
                if (distance < 200 && !btn.disabled) {
                    const angle = Math.atan2(y - btnCenterY, x - btnCenterX);
                    const force = (200 - distance) / 20;
                    
                    btn.style.transform = `translate(${Math.cos(angle) * force}px, ${Math.sin(angle) * force}px)`;
                } else {
                    btn.style.transform = '';
                }
            });
        }

        // Event listeners
        btn.addEventListener('click', handleButtonClick);

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial translations
            buttonText.textContent = t.buttonText;
            
            fetchAndUpdateStatus();
            showSuccessToast();
            
            // Update data every 30 seconds
            setInterval(fetchAndUpdateStatus, 30000);
        });
    </script>
</body>
</html>

